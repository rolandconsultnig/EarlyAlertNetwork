container_commands:
  01_install_dependencies:
    command: "npm ci"
  02_build_application:
    command: "npm run build"
  03_set_permissions:
    command: "chmod -R 755 /var/app/current"

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_run_migrations.sh":
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      #!/bin/bash
      
      # Get environment variables
      source /opt/elasticbeanstalk/support/envvars
      
      # Go to the application directory
      cd /var/app/current
      
      # Run database migrations
      echo "Running database migrations..."
      npm run db:push
      
      echo "Migrations completed successfully"